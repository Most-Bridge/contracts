// SPDX-License-Identifier: MIT
pragma solidity ^0.8.26;

import {Script} from "forge-std/Script.sol";
import {Escrow} from "src/contracts/Escrow.sol";
import {HookExecutor} from "src/contracts/HookExecutor.sol";

contract CreateOrder is Script {
    function run() external {
        vm.startBroadcast();

        // Escrow contract address
        address escrowAddress = 0xbAF6625e54035Ed93B3FEa38fa5F0aba1fBC5027;
        Escrow escrow = Escrow(payable(escrowAddress));

        // === Order Parameters ===
        bytes32 usrDstAddress = bytes32(uint256(uint160(0xe727dbADBB18c998e5DeE2faE72cBCFfF2e6d03D))); // DST_ADDRESS
        //address srcToken = 0x1f9840a85d5aF5bf1D1762F925BDADdC4201F984; // UNI
        //address srcToken = 0x03d3811Bc0AEAbcB9E5B94A7725B061153aF422b; // MOST
        address srcToken = 0x2cFc85d8E48F8EAB294be644d9E25C3030863003; // WLD on Worldchain
        uint256 srcAmount = 0.1 ether; // Amount of coins, if input token has 1 decomals it will work

        bytes32 dstToken = bytes32(uint256(0x049d36570d4e46f48e99674bd3fcc84644ddd6b96f7c741b1562b82f9e004dc7));
        uint256 dstAmount = 0.000001 ether; // USDC

        bytes32 dstChainId = bytes32(uint256(0x534e5f5345504f4c4941)); // "SN_SEPOLIA"
        uint256 expiryWindow = 86400; // 1 day

        bool useSwap = true;
        //address expectedOutToken = 0x1c7D4B196Cb0C7B01d743Fbc6116a902379C7238; // USDC
        address expectedOutToken = 0x79A02482A880bCE3F13e09Da970dC34db4CD24d1; // USDC on Worldchain
        bytes32 hookExecutorSalt = bytes32(uint256(0x01a4));

        // === Hook parameters ===
        //address swapHookTarget = 0x3A9D48AB9751398BbFa63ad67599Bb04e4BdF98b; // UniversalRouter eth sepolia
        address swapHookTarget = 0x8ac7bEE993bb44dAb564Ea4bc9EA67Bf9Eb5e743; // Universal router WLD mainnet
        //address swapHookTarget = 0x091AD9e2e6e5eD44c1c66dB50e49A601F9f36cF6; // Swap router WLD mainnet

        // bytes memory hookCallData =
        //     hex"3593564c000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000687e9e9000000000000000000000000000000000000000000000000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000360000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003060c0f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000260000000000000000000000000000000000000000000000000000000000000018000000000000000000000000000000000000000000000000000000000000000200000000000000000000000002cfc85d8e48f8eab294be644d9e25c303086300300000000000000000000000079a02482a880bce3f13e09da970dc34db4cd24d100000000000000000000000000000000000000000000000000000000000000640000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000de0b6b3a764000000000000000000000000000000000000000000000000000000000000000f424000000000000000000000000000000000000000000000000000000000000001200000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000002cfc85d8e48f8eab294be644d9e25c30308630030000000000000000000000000000000000000000000000000de0b6b3a7640000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000079a02482a880bce3f13e09da970dc34db4cd24d100000000000000000000000000000000000000000000000000000000000f4240";

            bytes memory swapHookCallData =
                hex"3593564c000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000687f7b9a0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000012000000000000000000000000060b94f5e1f88b6ccb8976d93439ceddc6bdc6577000000000000000000000000000000000000000000000000016345785d8a000000000000000000000000000000000000000000000000000000000000000186a000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000422cfc85d8e48f8eab294be644d9e25c3030863003000bb84200000000000000000000000000000000000006000bb879a02482a880bce3f13e09da970dc34db4cd24d1000000000000000000000000000000000000000000000000000000000000";


        address approveHooktarget = 0x000000000022D473030F116dDEE9F6B43aC78BA3;
        bytes memory approveHookCallData1 =
                hex"87517c450000000000000000000000002cfc85d8e48f8eab294be644d9e25c30308630030000000000000000000000008ac7bee993bb44dab564ea4bc9ea67bf9eb5e743000000000000000000000000000000000000000000000000016345785d8a0000000000000000000000000000000000000000000000000000000000006fa05a28";


        HookExecutor.Hook[] memory hooks = new HookExecutor.Hook[](2);
        hooks[0] = HookExecutor.Hook({target: approveHooktarget, callData: approveHookCallData1});
        hooks[1] = HookExecutor.Hook({target: swapHookTarget, callData: swapHookCallData});

        // === Call the function ===
        escrow.createOrder(
            usrDstAddress,
            srcToken,
            srcAmount,
            dstToken,
            dstAmount,
            dstChainId,
            expiryWindow,
            useSwap,
            expectedOutToken,
            hookExecutorSalt,
            hooks
        );

        vm.stopBroadcast();
    }
}

// forge script script/escrow/create_order/CreateOrder.s.sol:CreateOrder \
//   --rpc-url $ETH_SEPOLIA_RPC \
//   --broadcast \
//   --private-key $USR_SRC_PRIVATE_KEY
