// SPDX-License-Identifier: MIT
pragma solidity ^0.8.26;

import {Script} from "forge-std/Script.sol";
import {Escrow} from "src/contracts/Escrow.sol";
import {HookExecutor} from "src/contracts/HookExecutor.sol";

contract CreateOrder is Script {
    function run() external {
        vm.startBroadcast();

        // Escrow contract address
        address escrowAddress = 0xaD465Acfce0F18407231883164DBDc41AfeD6fDB;
        Escrow escrow = Escrow(payable(escrowAddress));

        // === Order Parameters ===
        bytes32 usrDstAddress = bytes32(uint256(uint160(0xe727dbADBB18c998e5DeE2faE72cBCFfF2e6d03D))); // DST_ADDRESS
        address srcToken = 0x1f9840a85d5aF5bf1D1762F925BDADdC4201F984; // UNI
        uint256 srcAmount = 0.000001 ether;

        bytes32 dstToken = bytes32(uint256(0x049d36570d4e46f48e99674bd3fcc84644ddd6b96f7c741b1562b82f9e004dc7));
        uint256 dstAmount = 0.000001 ether; // USDC

        bytes32 dstChainId = bytes32(uint256(0x534e5f5345504f4c4941)); // "SN_SEPOLIA"
        uint256 expiryWindow = 86400; // 1 day

        bool useSwap = true;
        address expectedOutToken = 0x1c7D4B196Cb0C7B01d743Fbc6116a902379C7238; // USDC
        bytes32 hookExecutorSalt = bytes32(uint256(0x01a4));

        // === Hook parameters ===
        address hookTarget = 0x3A9D48AB9751398BbFa63ad67599Bb04e4BdF98b;
        bytes memory hookCallData =
            hex"3593564c000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000687815bd0000000000000000000000000000000000000000000000000000000000000003100604000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000044000000000000000000000000000000000000000000000000000000000000004c000000000000000000000000000000000000000000000000000000000000003c0000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003070b0e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000002a000000000000000000000000000000000000000000000000000000000000001a000000000000000000000000000000000000000000000000000000000000000200000000000000000000000001f9840a85d5af5bf1d1762f925bdaddc4201f9840000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000e8d4a510000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000001c7d4b196cb0c7b01d743fbc6116a902379c723800000000000000000000000000000000000000000000000000000000000000640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000001f9840a85d5af5bf1d1762f925bdaddc4201f9840000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000600000000000000000000000001c7d4b196cb0c7b01d743fbc6116a902379c72380000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000001c7d4b196cb0c7b01d743fbc6116a902379c7238000000000000000000000000e49acc3b16c097ec88dc9352ce4cd57ab7e35b95000000000000000000000000000000000000000000000000000000000000001900000000000000000000000000000000000000000000000000000000000000600000000000000000000000001c7d4b196cb0c7b01d743fbc6116a902379c72380000000000000000000000000f7a8cd029e284b04bed36a75ce4adc5068c374d00000000000000000000000000000000000000000000000000000000000c7c7e0c";

        HookExecutor.Hook[] memory hooks = new HookExecutor.Hook[](1);
        hooks[0] = HookExecutor.Hook({target: hookTarget, callData: hookCallData});

        // === Call the function ===
        escrow.createOrder(
            usrDstAddress,
            srcToken,
            srcAmount,
            dstToken,
            dstAmount,
            dstChainId,
            expiryWindow,
            useSwap,
            expectedOutToken,
            hookExecutorSalt,
            hooks
        );

        vm.stopBroadcast();
    }
}

// forge script script/escrow/create_order/CreateOrder.s.sol:CreateOrder \
//   --rpc-url $ETH_SEPOLIA_RPC \
//   --broadcast \
//   --private-key $USR_SRC_PRIVATE_KEY
