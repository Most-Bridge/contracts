// SPDX-License-Identifier: MIT
pragma solidity ^0.8.26;

import {Script} from "forge-std/Script.sol";
import {Escrow} from "src/contracts/Escrow.sol";
import {HookExecutor} from "src/contracts/HookExecutor.sol";

contract CreateOrder is Script {
    function run() external {
        vm.startBroadcast();

        // Escrow contract address
        address escrowAddress = 0xaD465Acfce0F18407231883164DBDc41AfeD6fDB;
        Escrow escrow = Escrow(payable(escrowAddress));

        // === Order Parameters ===
        bytes32 usrDstAddress = bytes32(uint256(uint160(0xe727dbADBB18c998e5DeE2faE72cBCFfF2e6d03D))); // DST_ADDRESS
        //address srcToken = 0x1f9840a85d5aF5bf1D1762F925BDADdC4201F984; // UNI
        address srcToken = 0x03d3811Bc0AEAbcB9E5B94A7725B061153aF422b; // MOST
        uint256 srcAmount = 1 ether;

        bytes32 dstToken = bytes32(uint256(0x049d36570d4e46f48e99674bd3fcc84644ddd6b96f7c741b1562b82f9e004dc7));
        uint256 dstAmount = 0.000001 ether; // USDC

        bytes32 dstChainId = bytes32(uint256(0x534e5f5345504f4c4941)); // "SN_SEPOLIA"
        uint256 expiryWindow = 86400; // 1 day

        bool useSwap = true;
        address expectedOutToken = 0x1c7D4B196Cb0C7B01d743Fbc6116a902379C7238; // USDC
        bytes32 hookExecutorSalt = bytes32(uint256(0x01a4));

        // === Hook parameters ===
        address hookTarget = 0x3A9D48AB9751398BbFa63ad67599Bb04e4BdF98b;
        bytes memory hookCallData =
            hex"3593564c000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000687950f300000000000000000000000000000000000000000000000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000360000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003060c0f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000002600000000000000000000000000000000000000000000000000000000000000180000000000000000000000000000000000000000000000000000000000000002000000000000000000000000003d3811bc0aeabcb9e5b94a7725b061153af422b0000000000000000000000001c7d4b196cb0c7b01d743fbc6116a902379c723800000000000000000000000000000000000000000000000000000000000000640000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000de0b6b3a76400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000003d3811bc0aeabcb9e5b94a7725b061153af422b0000000000000000000000000000000000000000000000000de0b6b3a764000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000001c7d4b196cb0c7b01d743fbc6116a902379c72380000000000000000000000000000000000000000000000000000000000000000";

        address hookTarget1 = 0x000000000022D473030F116dDEE9F6B43aC78BA3;
        bytes memory hookCallData1 =
                hex"87517c4500000000000000000000000003d3811bc0aeabcb9e5b94a7725b061153af422b0000000000000000000000003a9d48ab9751398bbfa63ad67599bb04e4bdf98b0000000000000000000000000000000000000000000000000de0b6b3a76400000000000000000000000000000000000000000000000000000000000069aa7928";


        HookExecutor.Hook[] memory hooks = new HookExecutor.Hook[](2);
        hooks[0] = HookExecutor.Hook({target: hookTarget1, callData: hookCallData1});
        hooks[1] = HookExecutor.Hook({target: hookTarget, callData: hookCallData});

        // === Call the function ===
        escrow.createOrder(
            usrDstAddress,
            srcToken,
            srcAmount,
            dstToken,
            dstAmount,
            dstChainId,
            expiryWindow,
            useSwap,
            expectedOutToken,
            hookExecutorSalt,
            hooks
        );

        vm.stopBroadcast();
    }
}

// forge script script/escrow/create_order/CreateOrder.s.sol:CreateOrder \
//   --rpc-url $ETH_SEPOLIA_RPC \
//   --broadcast \
//   --private-key $USR_SRC_PRIVATE_KEY
