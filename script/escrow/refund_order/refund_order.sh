#!/usr/bin/env bash

# Load env vars
source .env && \
export ETHERSCAN_API_KEY=$ETH_ETHERSCAN_API_KEY

# ORDER DETAILS
ORDER_ID=33
SRC_ESCROW=$ESCROW_ADDRESS
USR_SRC_ADDRESS=$USR_SRC_ADDRESS
USR_DST_ADDRESS=0x034501931e05c7934a0c6246fc7409cf9e650538f330a6b7a36f134c3b0577ee # bytes32 format!
EXPIRATION_TIMESTAMP=1750188430  
SRC_TOKEN=0x0000000000000000000000000000000000000000 # Native ETH
SRC_AMOUNT=100000000000000
DST_TOKEN=0x049d36570d4e46f48e99674bd3fcc84644ddd6b96f7c741b1562b82f9e004dc7 # ETH ON STARKNET
DST_AMOUNT=90000000000000
SRC_CHAIN_ID=0x0000000000000000000000000000000000000000000000000000000000aa36a7 # Sepolia
DST_CHAIN_ID=0x00000000000000000000000000000000000000000000534e5f5345504f4c4941


cast send \
  --rpc-url $ETH_SEPOLIA_RPC \
  --private-key $USR_SRC_PRIVATE_KEY \
  $ESCROW_ADDRESS \
  "refundOrder((uint256,address,address,bytes32,uint256,address,uint256,bytes32,uint256,uint256,bytes32))" \
  "($ORDER_ID,$SRC_ESCROW,$USR_SRC_ADDRESS,$USR_DST_ADDRESS,$EXPIRATION_TIMESTAMP,$SRC_TOKEN,$SRC_AMOUNT,$DST_TOKEN,$DST_AMOUNT,$SRC_CHAIN_ID,$DST_CHAIN_ID)"


# CHECK THE ORDER HASH FOR A GIVEN ORDER ID
# cast call $ESCROW_ADDRESS "orders(uint256)" $ORDER_ID --rpc-url $ETH_SEPOLIA_RPC
# 0xc7bc4d70bda7866617db0a435eaa7599e23ef6b45b5626b27cd2dbe9792b6198 -- expected hash output for the order 33 


# cast keccak256 $(cast abi-encode \
#   "createOrderHash((uint256,address,address,bytes32,uint256,address,uint256,bytes32,uint256,uint256,bytes32))" \
#   $ORDER_ID \
#   $SRC_ESCROW \
#   $USR_SRC_ADDRESS \
#   $USR_DST_ADDRESS \
#   $EXPIRATION_TIMESTAMP \
#   $SRC_TOKEN \
#   $SRC_AMOUNT \
#   $DST_TOKEN \
#   $DST_AMOUNT \
#   $SRC_CHAIN_ID \
#   $DST_CHAIN_ID)


# {
#   id: "01JXZNQYDWGKC14EFCKP9SKTD4",
#   orderId: 33n,
#   orderHash: "0xc7bc4d70bda7866617db0a435eaa7599e23ef6b45b5626b27cd2dbe9792b6198",
#   sourceAmount: 100000000000000n,
#   destinationAmount: 90000000000000n,
#   sourceChainId: "0xaa36a7",
#   destinationChainId: "0x534e5f5345504f4c4941",
#   usrDstAddress: "0x034501931e05c7934a0c6246fc7409cf9e650538f330a6b7a36f134c3b0577ee",
#   usrSrcAddress: "0x682a550cc99C02e12Caeb40B2C745E2Daa003215",
#   fee: 0,
#   status: "INCOMING",
#   sourceChainTxHash: "0x3732ca63d710edee11222415b872e7ad3a3d299a3ab0650836cb156db6842137",
#   expirationTimestamp: 2025-06-17T19:27:10.000Z,
#   usedEscrowContractAddress: "0xec20f1842eb749aafb9b2241c989fd3e76ad262f",
#   sourceTokenContractAddress: "0x0000000000000000000000000000000000000000",
#   destinationTokenContractAddress: "0x049d36570d4e46f48e99674bd3fcc84644ddd6b96f7c741b1562b82f9e004dc7",
#   createdAt: 2025-06-17T19:27:03.612Z,